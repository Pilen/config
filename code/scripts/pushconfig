# ! /bin/sh

cd ~

if [ $# -ne 0 ];
then
    commitmsg=$*;
else
    commitmsg="Configuration updated";
fi

chmod +x ~/code/scripts/*
hostname > ~/.last_pusher

# echo -n "old size: "
# wget -qO- https://raw.github.com/Pilen/config/master/.emacs | wc -l
# echo -n "new size: "
# wc -l ~/.emacs
# ~/code/scripts/copyaliases.py
# echo

#This is basicly a list of all the files i want to keep track of.
files=(
    # directories:
    '.emacs.d'
    '.xmonad/xmonad.hs'
    'code/scripts'
    # files:
    '.Xdefaults'
    '.Xmodmap'
    '.aliases'
    '.bashrc'
    '.git_prompt.zsh'
    # '.gitignore'
    '.last_pusher'
    '.nanorc'
    '.xinitrc'
    '.zshrc'
    );

rm -rf ~/config/tmp
mkdir ~/config/tmp
for file in "${files[@]}"
do
    # echo "$file"
    # rsync -r ~/"$file" ~/config/tmp/
    if [[ -d $file ]]
    then
        cp -r --parent "$file" ~/config/tmp/
    else
        dir=~/config/tmp/$(dirname "$file");
        if [[ ! -d $dir ]]
        then
            mkdir $dir
        fi
        cp "$file" $dir;
    fi;
done

cp -r ~/config/.git ~/config/tmp/
cp -r ~/config/.gitignore ~/config/tmp/
cd ~/config/tmp/
git status

read -p "Do you wish to push? [Yy]: " reply
if [[ ! $reply =~ ^[Yy]$ ]]
then
    exit
fi;

echo "pushing"
echo
echo

git add *
git commit -m "$commitmsg";
git push
# git add ~/code/scripts/;
# git add ~/.emacs.d/;
# git add ~/.xmonad/xmonad.hs;
# git add ~/.bashrc;
# git add ~/.emacs;
# git add ~/.nanorc;
# #git add ~/.pushconfig;
# git add ~/.Xdefaults;
# git add ~/.xinitrc;
# git add ~/.zshrc;
# git add ~/.aliases;
# #git add ~/.copyaliases.py;
# git add ~/.Xmodmap;
# git add ~/.last_pusher
# #git add ~/.menu.sh
# #git add ~/.cal.pl
# #git add ~/.python2.py
# #git add ~/linkmenu.pl
# #git add ~/.config/chromium/Default/User StyleSheets/Custom.css
# git add ~/.gitignore
# git add ~/.git_prompt.zsh

# git commit -m "$commitmsg";
# git push

#Locales to update
echo
echo
echo Updating remote addreses:
ssh pilgaard@tyr.diku.dk git pull origin master

echo
echo
echo Files touched:
git show --pretty="format:" --name-only
