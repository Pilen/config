#!/usr/bin/env bash

export NO_AT_BRIDGE=1 # Makes Emacs not throw the warning: ** (emacs:3616): WARNING **: Couldn't connect to accessibility bus: Failed to connect to socket /tmp/dbus

# (setq ps-landscape-mode t) Does not work?
echo "$1"
if [ -z $2 ]; then
    emacs -Q "$1" --eval "(progn (set-face-attribute 'default nil :height 90) (when (derived-mode-p 'outline-mode) (outline-show-all)) (setq ps-paper-type (quote a4)) (setq ps-right-margin 20) (setq ps-left-margin 20) (ps-print-buffer-with-faces) (save-buffers-kill-terminal))"
else
    # Print to pdf $2
    # TEMP=$(mktemp -d)
    # PSFILE="$TEMP/out.ps"
    PSFILE="$2"
    emacs -Q "$1" --eval "(progn (set-face-attribute 'default nil :height 90) (when (derived-mode-p 'outline-mode) (outline-show-all)) (setq ps-paper-type (quote a4)) (setq ps-right-margin 20) (setq ps-left-margin 20) (ps-print-buffer-with-faces \"$PSFILE\") (save-buffers-kill-terminal))"
    # ps2pdf "$PSFILE" "$2"
    # rm -r "$TEMP"
fi
